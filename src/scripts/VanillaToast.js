var ToastType;
(function (ToastType) {
    ToastType["SUCCESS"] = "success";
    ToastType["INFO"] = "info";
    ToastType["WARNING"] = "warning";
    ToastType["ERROR"] = "error";
    ToastType["PLAIN"] = "plain";
    ToastType["CUSTOM"] = "custom";
})(ToastType || (ToastType = {}));
var ToastPosition;
(function (ToastPosition) {
    ToastPosition["TOP_RIGHT"] = "top-right";
    ToastPosition["TOP_LEFT"] = "top-left";
    ToastPosition["BOTTOM_RIGHT"] = "bottom-right";
    ToastPosition["BOTTOM_LEFT"] = "bottom-left";
})(ToastPosition || (ToastPosition = {}));
var VanillaToast = (function () {
    function VanillaToast(parent) {
        this.REMOVE_TIME_MS = 3000;
        this.REMOVE_TIME_MIN_MS = 300;
        if (parent == null ||
            parent == "body" ||
            parent == "window" ||
            parent == document.body ||
            parent == window) {
            this.useFixedParent();
        }
        else {
            this.parent = parent;
        }
    }
    VanillaToast.prototype.showSuccess = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.SUCCESS);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showInfo = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.INFO);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showWarning = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.WARNING);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showError = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.ERROR);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showPlain = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.PLAIN);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showCustom = function (title, message, iconUrl, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.CUSTOM, iconUrl);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.getCustomToast = function (title, message, type, iconUrl) {
        if (!title)
            title = " ";
        if (!message)
            message = " ";
        var icon = '<div class="vanilla-toast-icon"></div>';
        if (type == ToastType.CUSTOM) {
            icon = '<div class="vanilla-toast-icon" style="background-image: url(' + iconUrl + ');"></div>';
        }
        var toast = document.createElement("div");
        toast.className = "vanilla-toast vanilla-toast-" + type;
        toast.style.display = "none";
        toast.insertAdjacentHTML("afterbegin", icon +
            '<div class="vanilla-toast-text">' +
            '<div class="vanilla-toast-title">' + title + '</div>' +
            '<div class="vanilla-toast-message">' + message + '</div></div>');
        toast.fade = function (type, ms, onEnd) {
            var self = toast;
            var isIn = type === 'in', opacity = isIn ? 0 : 1, interval = 10, duration = ms, gap = interval / duration;
            if (isIn) {
                self.style.display = 'block';
                self.style.opacity = opacity;
            }
            function func() {
                opacity = isIn ? opacity + gap : opacity - gap;
                self.style.opacity = opacity;
                if (opacity <= 0)
                    self.style.display = 'none';
                if (opacity <= 0 || opacity >= 1) {
                    window.clearInterval(fading);
                    if (onEnd != null)
                        onEnd();
                }
            }
            var fading = window.setInterval(func, interval);
        };
        toast.fadeIn = function (ms, onEnd) {
            toast.fade("in", ms, onEnd);
        };
        toast.fadeOut = function (ms, onEnd) {
            toast.fade("out", ms, onEnd);
        };
        return toast;
    };
    VanillaToast.prototype.addToast = function (toast, position, duration) {
        if (duration === void 0) { duration = 0; }
        var self = this;
        if (duration >= 0 && duration <= self.REMOVE_TIME_MIN_MS) {
            duration = self.REMOVE_TIME_MIN_MS;
        }
        var container = this.getContainer(position);
        container.appendChild(toast);
        var closeBtn = document.createElement("div");
        closeBtn.className = "vanilla-toast-icon-close";
        toast.appendChild(closeBtn);
        closeBtn.addEventListener("pointerdown", function () {
            self.removeToast(toast);
        });
        if (duration > 0) {
            setTimeout(function () {
                self.removeToast(toast);
            }, duration);
        }
        toast.fadeIn(VanillaToast.FADE_MS);
        return toast;
    };
    VanillaToast.prototype.getContainer = function (position) {
        if (position == ToastPosition.TOP_LEFT && !this.containerTopLeft) {
            this.containerTopLeft = this.createContainer(position);
        }
        else if (position == ToastPosition.TOP_RIGHT && !this.containerTopRight) {
            this.containerTopRight = this.createContainer(position);
        }
        else if (position == ToastPosition.BOTTOM_LEFT && !this.containerBottomLeft) {
            this.containerBottomLeft = this.createContainer(position);
        }
        else if (position == ToastPosition.BOTTOM_RIGHT && !this.containerBottomRight) {
            this.containerBottomRight = this.createContainer(position);
        }
        if (position == ToastPosition.TOP_LEFT) {
            return this.containerTopLeft;
        }
        else if (position == ToastPosition.TOP_RIGHT) {
            return this.containerTopRight;
        }
        else if (position == ToastPosition.BOTTOM_LEFT) {
            return this.containerBottomLeft;
        }
        else if (position == ToastPosition.BOTTOM_RIGHT) {
            return this.containerBottomRight;
        }
        return this.containerBottomLeft;
    };
    VanillaToast.prototype.createContainer = function (position) {
        var container = document.createElement("div");
        container.className = "vanilla-toast-container-" + position;
        this.parent.appendChild(container);
        return container;
    };
    VanillaToast.prototype.useFixedParent = function () {
        var containers = document.getElementsByClassName("vanilla-toast-container-fixed");
        if (containers != null && containers.length > 0) {
            this.parent = containers[0];
            return;
        }
        var container = document.createElement("div");
        container.className = "vanilla-toast-container-fixed";
        document.body.appendChild(container);
        this.parent = container;
    };
    VanillaToast.prototype.removeToast = function (toast) {
        toast.fadeOut(VanillaToast.FADE_MS, function () {
            toast.remove();
        });
    };
    VanillaToast.FADE_MS = 400;
    return VanillaToast;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvVmFuaWxsYVRvYXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUssU0FPSjtBQVBELFdBQUssU0FBUztJQUNaLGdDQUFtQixDQUFBO0lBQ25CLDBCQUFhLENBQUE7SUFDYixnQ0FBbUIsQ0FBQTtJQUNuQiw0QkFBZSxDQUFBO0lBQ2YsNEJBQWUsQ0FBQTtJQUNmLDhCQUFpQixDQUFBO0FBQ25CLENBQUMsRUFQSSxTQUFTLEtBQVQsU0FBUyxRQU9iO0FBRUQsSUFBSyxhQUtKO0FBTEQsV0FBSyxhQUFhO0lBQ2hCLHdDQUF1QixDQUFBO0lBQ3ZCLHNDQUFxQixDQUFBO0lBQ3JCLDhDQUE2QixDQUFBO0lBQzdCLDRDQUEyQixDQUFBO0FBQzdCLENBQUMsRUFMSSxhQUFhLEtBQWIsYUFBYSxRQUtqQjtBQUVEO0lBWUUsc0JBQVksTUFBVztRQVRmLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLHVCQUFrQixHQUFHLEdBQUcsQ0FBQztRQVMvQixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSTtZQUNoQixNQUFNLElBQUksTUFBTTtZQUNoQixNQUFNLElBQUksUUFBUTtZQUNsQixNQUFNLElBQUksUUFBUSxDQUFDLElBQUk7WUFDdkIsTUFBTSxJQUFJLE1BQ1osQ0FBQyxDQUFDLENBQUM7WUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDeEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDdkIsQ0FBQztJQUNILENBQUM7SUFFTSxrQ0FBVyxHQUFsQixVQUFtQixLQUFhLEVBQUUsT0FBZSxFQUFFLFFBQW1ELEVBQUUsUUFBOEI7UUFBbkYseUJBQUEsRUFBQSxXQUEwQixhQUFhLENBQUMsV0FBVztRQUFFLHlCQUFBLEVBQUEsV0FBVyxJQUFJLENBQUMsY0FBYztRQUNwSSxJQUFJLElBQUksR0FBZ0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVB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QUM7SUFDMUIsQ0FBQztJQUVPLGtDQUFXLEdBQW5CLFVBQW9CLEtBQVU7UUFFNUIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFO1lBQ2hDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQ0YsQ0FBQztJQUNKLENBQUM7SUEzTWMsb0JBQU8sR0FBRyxHQUFHLENBQUM7SUE0TS9CLG1CQUFDO0NBOU1ELEFBOE1DLElBQUEiLCJmaWxlIjoic2NyaXB0cy9WYW5pbGxhVG9hc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJlbnVtIFRvYXN0VHlwZSB7XG4gIFNVQ0NFU1MgPSBcInN1Y2Nlc3NcIixcbiAgSU5GTyA9IFwiaW5mb1wiLFxuICBXQVJOSU5HID0gXCJ3YXJuaW5nXCIsXG4gIEVSUk9SID0gXCJlcnJvclwiLFxuICBQTEFJTiA9IFwicGxhaW5cIixcbiAgQ1VTVE9NID0gXCJjdXN0b21cIlxufVxuXG5lbnVtIFRvYXN0UG9zaXRpb24ge1xuICBUT1BfUklHSFQgPSBcInRvcC1yaWdodFwiLFxuICBUT1BfTEVGVCA9IFwidG9wLWxlZnRcIixcbiAgQk9UVE9NX1JJR0hUID0gXCJib3R0b20tcmlnaHRcIixcbiAgQk9UVE9NX0xFRlQgPSBcImJvdHRvbS1sZWZ0XCJcbn1cblxuY2xhc3MgVmFuaWxsYVRvYXN0IHtcblxuICBwcml2YXRlIHN0YXRpYyBGQURFX01TID0gNDAwO1xuICBwcml2YXRlIFJFTU9WRV9USU1FX01TID0gMzAwMDtcbiAgcHJpdmF0ZSBSRU1PVkVfVElNRV9NSU5fTVMgPSAzMDA7XG5cbiAgcHJpdmF0ZSBwYXJlbnQ6IGFueTtcbiAgcHJpdmF0ZSBjb250YWluZXJUb3BMZWZ0OiBhbnk7XG4gIHByaXZhdGUgY29udGFpbmVyVG9wUmlnaHQ6IGFueTtcbiAgcHJpdmF0ZSBjb250YWluZXJCb3R0b21MZWZ0OiBhbnk7XG4gIHByaXZhdGUgY29udGFpbmVyQm90dG9tUmlnaHQ6IGFueTtcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IGFueSkge1xuICAgIGlmIChwYXJlbnQgPT0gbnVsbCB8fFxuICAgICAgcGFyZW50ID09IFwiYm9keVwiIHx8XG4gICAgICBwYXJlbnQgPT0gXCJ3aW5kb3dcIiB8fFxuICAgICAgcGFyZW50ID09IGRvY3VtZW50LmJvZHkgfHxcbiAgICAgIHBhcmVudCA9PSB3aW5kb3dcbiAgICApIHtcbiAgICAgIHRoaXMudXNlRml4ZWRQYXJlbnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNob3dTdWNjZXNzKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZULCBkdXJhdGlvbiA9IHRoaXMuUkVNT1ZFX1RJTUVfTVMpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRleHQ6IEhUTUxFbGVtZW50ID0gdGhpcy5nZXRDdXN0b21Ub2FzdCh0aXRsZSwgbWVzc2FnZSwgVG9hc3RUeXBlLlNVQ0NFU1MpO1xuICAgIGxldCB0b2FzdDogSFRNTEVsZW1lbnQgPSB0aGlzLmFkZFRvYXN0KHRleHQsIHBvc2l0aW9uLCBkdXJhdGlvbik7XG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHVibGljIHNob3dJbmZvKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZULCBkdXJhdGlvbiA9IHRoaXMuUkVNT1ZFX1RJTUVfTVMpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRleHQ6IEhUTUxFbGVtZW50ID0gdGhpcy5nZXRDdXN0b21Ub2FzdCh0aXRsZSwgbWVzc2FnZSwgVG9hc3RUeXBlLklORk8pO1xuICAgIGxldCB0b2FzdDogSFRNTEVsZW1lbnQgPSB0aGlzLmFkZFRvYXN0KHRleHQsIHBvc2l0aW9uLCBkdXJhdGlvbik7XG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHVibGljIHNob3dXYXJuaW5nKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZULCBkdXJhdGlvbiA9IHRoaXMuUkVNT1ZFX1RJTUVfTVMpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRleHQ6IEhUTUxFbGVtZW50ID0gdGhpcy5nZXRDdXN0b21Ub2FzdCh0aXRsZSwgbWVzc2FnZSwgVG9hc3RUeXBlLldBUk5JTkcpO1xuICAgIGxldCB0b2FzdDogSFRNTEVsZW1lbnQgPSB0aGlzLmFkZFRvYXN0KHRleHQsIHBvc2l0aW9uLCBkdXJhdGlvbik7XG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHVibGljIHNob3dFcnJvcih0aXRsZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIHBvc2l0aW9uOiBUb2FzdFBvc2l0aW9uID0gVG9hc3RQb3NpdGlvbi5CT1RUT01fTEVGVCwgZHVyYXRpb24gPSB0aGlzLlJFTU9WRV9USU1FX01TKTogSFRNTEVsZW1lbnQge1xuICAgIGxldCB0ZXh0OiBIVE1MRWxlbWVudCA9IHRoaXMuZ2V0Q3VzdG9tVG9hc3QodGl0bGUsIG1lc3NhZ2UsIFRvYXN0VHlwZS5FUlJPUik7XG4gICAgbGV0IHRvYXN0OiBIVE1MRWxlbWVudCA9IHRoaXMuYWRkVG9hc3QodGV4dCwgcG9zaXRpb24sIGR1cmF0aW9uKTtcbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwdWJsaWMgc2hvd1BsYWluKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZULCBkdXJhdGlvbiA9IHRoaXMuUkVNT1ZFX1RJTUVfTVMpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRleHQ6IEhUTUxFbGVtZW50ID0gdGhpcy5nZXRDdXN0b21Ub2FzdCh0aXRsZSwgbWVzc2FnZSwgVG9hc3RUeXBlLlBMQUlOKTtcbiAgICBsZXQgdG9hc3Q6IEhUTUxFbGVtZW50ID0gdGhpcy5hZGRUb2FzdCh0ZXh0LCBwb3NpdGlvbiwgZHVyYXRpb24pO1xuICAgIHJldHVybiB0b2FzdDtcbiAgfVxuXG4gIHB1YmxpYyBzaG93Q3VzdG9tKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgaWNvblVybDogc3RyaW5nLCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQsIGR1cmF0aW9uID0gdGhpcy5SRU1PVkVfVElNRV9NUyk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGV4dDogSFRNTEVsZW1lbnQgPSB0aGlzLmdldEN1c3RvbVRvYXN0KHRpdGxlLCBtZXNzYWdlLCBUb2FzdFR5cGUuQ1VTVE9NLCBpY29uVXJsKTtcbiAgICBsZXQgdG9hc3Q6IEhUTUxFbGVtZW50ID0gdGhpcy5hZGRUb2FzdCh0ZXh0LCBwb3NpdGlvbiwgZHVyYXRpb24pO1xuICAgIHJldHVybiB0b2FzdDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q3VzdG9tVG9hc3QodGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCB0eXBlOiBUb2FzdFR5cGUsIGljb25Vcmw/OiBzdHJpbmcpOiBIVE1MRWxlbWVudCB7XG5cbiAgICBpZiAoIXRpdGxlKSB0aXRsZSA9IFwiIFwiO1xuICAgIGlmICghbWVzc2FnZSkgbWVzc2FnZSA9IFwiIFwiO1xuXG4gICAgbGV0IGljb24gPSAnPGRpdiBjbGFzcz1cInZhbmlsbGEtdG9hc3QtaWNvblwiPjwvZGl2Pic7XG4gICAgaWYgKHR5cGUgPT0gVG9hc3RUeXBlLkNVU1RPTSkge1xuICAgICAgaWNvbiA9ICc8ZGl2IGNsYXNzPVwidmFuaWxsYS10b2FzdC1pY29uXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyArIGljb25VcmwgKyAnKTtcIj48L2Rpdj4nO1xuICAgIH1cblxuICAgIGxldCB0b2FzdDogYW55ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0b2FzdC5jbGFzc05hbWUgPSBcInZhbmlsbGEtdG9hc3QgdmFuaWxsYS10b2FzdC1cIiArIHR5cGU7XG4gICAgdG9hc3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHRvYXN0Lmluc2VydEFkamFjZW50SFRNTChcImFmdGVyYmVnaW5cIixcbiAgICAgIGljb24gK1xuICAgICAgJzxkaXYgY2xhc3M9XCJ2YW5pbGxhLXRvYXN0LXRleHRcIj4nICtcbiAgICAgICc8ZGl2IGNsYXNzPVwidmFuaWxsYS10b2FzdC10aXRsZVwiPicgKyB0aXRsZSArICc8L2Rpdj4nICtcbiAgICAgICc8ZGl2IGNsYXNzPVwidmFuaWxsYS10b2FzdC1tZXNzYWdlXCI+JyArIG1lc3NhZ2UgKyAnPC9kaXY+PC9kaXY+J1xuICAgICk7XG5cbiAgICB0b2FzdC5mYWRlID0gKHR5cGU6IHN0cmluZywgbXM6IG51bWJlciwgb25FbmQ/OiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICBsZXQgc2VsZjogYW55ID0gdG9hc3Q7XG5cbiAgICAgIGxldCBpc0luID0gdHlwZSA9PT0gJ2luJyxcbiAgICAgICAgb3BhY2l0eSA9IGlzSW4gPyAwIDogMSxcbiAgICAgICAgaW50ZXJ2YWwgPSAxMCxcbiAgICAgICAgZHVyYXRpb24gPSBtcyxcbiAgICAgICAgZ2FwID0gaW50ZXJ2YWwgLyBkdXJhdGlvbjtcblxuICAgICAgaWYgKGlzSW4pIHtcbiAgICAgICAgc2VsZi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgc2VsZi5zdHlsZS5vcGFjaXR5ID0gb3BhY2l0eTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZnVuYygpIHtcbiAgICAgICAgb3BhY2l0eSA9IGlzSW4gPyBvcGFjaXR5ICsgZ2FwIDogb3BhY2l0eSAtIGdhcDtcbiAgICAgICAgc2VsZi5zdHlsZS5vcGFjaXR5ID0gb3BhY2l0eTtcblxuICAgICAgICBpZiAob3BhY2l0eSA8PSAwKSBzZWxmLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICAgICAgaWYgKG9wYWNpdHkgPD0gMCB8fCBvcGFjaXR5ID49IDEpIHtcbiAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChmYWRpbmcpO1xuICAgICAgICAgIGlmIChvbkVuZCAhPSBudWxsKSBvbkVuZCgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBmYWRpbmcgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuYywgaW50ZXJ2YWwpO1xuICAgIH07XG5cbiAgICB0b2FzdC5mYWRlSW4gPSAobXM6IG51bWJlciwgb25FbmQ/OiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICB0b2FzdC5mYWRlKFwiaW5cIiwgbXMsIG9uRW5kKTtcbiAgICB9O1xuXG4gICAgdG9hc3QuZmFkZU91dCA9IChtczogbnVtYmVyLCBvbkVuZD86ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIHRvYXN0LmZhZGUoXCJvdXRcIiwgbXMsIG9uRW5kKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRUb2FzdCh0b2FzdDogYW55LCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiwgZHVyYXRpb246IG51bWJlciA9IDApOiBIVE1MRWxlbWVudCB7XG5cbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICBpZiAoZHVyYXRpb24gPj0gMCAmJiBkdXJhdGlvbiA8PSBzZWxmLlJFTU9WRV9USU1FX01JTl9NUykge1xuICAgICAgZHVyYXRpb24gPSBzZWxmLlJFTU9WRV9USU1FX01JTl9NUztcbiAgICB9XG5cbiAgICBsZXQgY29udGFpbmVyOiBhbnkgPSB0aGlzLmdldENvbnRhaW5lcihwb3NpdGlvbik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRvYXN0KTtcblxuICAgIC8vIEFkZCBjbG9zZSBidXR0b25cbiAgICBsZXQgY2xvc2VCdG46IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjbG9zZUJ0bi5jbGFzc05hbWUgPSBcInZhbmlsbGEtdG9hc3QtaWNvbi1jbG9zZVwiO1xuICAgIHRvYXN0LmFwcGVuZENoaWxkKGNsb3NlQnRuKTtcblxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZWxmLnJlbW92ZVRvYXN0KHRvYXN0KTtcbiAgICB9KTtcblxuICAgIGlmIChkdXJhdGlvbiA+IDApIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLnJlbW92ZVRvYXN0KHRvYXN0KVxuICAgICAgfSwgZHVyYXRpb24pO1xuICAgIH1cblxuICAgIHRvYXN0LmZhZGVJbihWYW5pbGxhVG9hc3QuRkFERV9NUyk7XG5cbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwcml2YXRlIGdldENvbnRhaW5lcihwb3NpdGlvbjogVG9hc3RQb3NpdGlvbik6IGFueSB7XG5cbiAgICBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5UT1BfTEVGVCAmJiAhdGhpcy5jb250YWluZXJUb3BMZWZ0KSB7XG4gICAgICB0aGlzLmNvbnRhaW5lclRvcExlZnQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lcihwb3NpdGlvbik7XG4gICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PSBUb2FzdFBvc2l0aW9uLlRPUF9SSUdIVCAmJiAhdGhpcy5jb250YWluZXJUb3BSaWdodCkge1xuICAgICAgdGhpcy5jb250YWluZXJUb3BSaWdodCA9IHRoaXMuY3JlYXRlQ29udGFpbmVyKHBvc2l0aW9uKTtcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQgJiYgIXRoaXMuY29udGFpbmVyQm90dG9tTGVmdCkge1xuICAgICAgdGhpcy5jb250YWluZXJCb3R0b21MZWZ0ID0gdGhpcy5jcmVhdGVDb250YWluZXIocG9zaXRpb24pO1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5CT1RUT01fUklHSFQgJiYgIXRoaXMuY29udGFpbmVyQm90dG9tUmlnaHQpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyQm90dG9tUmlnaHQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lcihwb3NpdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKHBvc2l0aW9uID09IFRvYXN0UG9zaXRpb24uVE9QX0xFRlQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lclRvcExlZnQ7XG4gICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PSBUb2FzdFBvc2l0aW9uLlRPUF9SSUdIVCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyVG9wUmlnaHQ7XG4gICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZUKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb250YWluZXJCb3R0b21MZWZ0O1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5CT1RUT01fUklHSFQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lckJvdHRvbVJpZ2h0O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNvbnRhaW5lckJvdHRvbUxlZnQ7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNvbnRhaW5lcihwb3NpdGlvbjogVG9hc3RQb3NpdGlvbik6IGFueSB7XG4gICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwidmFuaWxsYS10b2FzdC1jb250YWluZXItXCIgKyBwb3NpdGlvbjtcbiAgICB0aGlzLnBhcmVudC5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIHVzZUZpeGVkUGFyZW50KCkge1xuXG4gICAgLy8gVHJ5IHRvIGZpbmQgYWxyZWFkeSBleGlzdGluZyBjb250YWluZXJcbiAgICBsZXQgY29udGFpbmVycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJ2YW5pbGxhLXRvYXN0LWNvbnRhaW5lci1maXhlZFwiKTtcbiAgICBpZiAoY29udGFpbmVycyAhPSBudWxsICYmIGNvbnRhaW5lcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5wYXJlbnQgPSBjb250YWluZXJzWzBdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInZhbmlsbGEtdG9hc3QtY29udGFpbmVyLWZpeGVkXCI7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXG4gICAgdGhpcy5wYXJlbnQgPSBjb250YWluZXI7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVRvYXN0KHRvYXN0OiBhbnkpIHtcblxuICAgIHRvYXN0LmZhZGVPdXQoVmFuaWxsYVRvYXN0LkZBREVfTVMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdG9hc3QucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxufVxuIl19
