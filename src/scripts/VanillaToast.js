var ToastType;
(function (ToastType) {
    ToastType["SUCCESS"] = "success";
    ToastType["INFO"] = "info";
    ToastType["WARNING"] = "warning";
    ToastType["ERROR"] = "error";
    ToastType["PLAIN"] = "plain";
    ToastType["CUSTOM"] = "custom";
})(ToastType || (ToastType = {}));
var ToastPosition;
(function (ToastPosition) {
    ToastPosition["TOP_RIGHT"] = "top-right";
    ToastPosition["TOP_LEFT"] = "top-left";
    ToastPosition["BOTTOM_RIGHT"] = "bottom-right";
    ToastPosition["BOTTOM_LEFT"] = "bottom-left";
})(ToastPosition || (ToastPosition = {}));
var VanillaToast = (function () {
    function VanillaToast(parent) {
        this.REMOVE_TIME_MS = 3000;
        this.REMOVE_TIME_MIN_MS = 300;
        if (parent == null ||
            parent == "body" ||
            parent == "window" ||
            parent == document.body ||
            parent == window) {
            this.useFixedParent();
        }
        else {
            this.parent = parent;
        }
    }
    VanillaToast.prototype.showSuccess = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.SUCCESS);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showInfo = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.INFO);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showWarning = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.WARNING);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showError = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.ERROR);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showPlain = function (title, message, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.PLAIN);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.showCustom = function (title, message, iconUrl, position, duration) {
        if (position === void 0) { position = ToastPosition.BOTTOM_LEFT; }
        if (duration === void 0) { duration = this.REMOVE_TIME_MS; }
        var text = this.getCustomToast(title, message, ToastType.CUSTOM, iconUrl);
        var toast = this.addToast(text, position, duration);
        return toast;
    };
    VanillaToast.prototype.getCustomToast = function (title, message, type, iconUrl) {
        if (!title)
            title = " ";
        if (!message)
            message = " ";
        var icon = '<div class="vanilla-toast-icon"></div>';
        if (type == ToastType.CUSTOM) {
            icon = '<div class="vanilla-toast-icon" style="background-image: url(' + iconUrl + ');"></div>';
        }
        var toast = document.createElement("div");
        toast.className = "vanilla-toast vanilla-toast-" + type;
        toast.style.display = "none";
        toast.insertAdjacentHTML("afterbegin", icon +
            '<div class="vanilla-toast-text">' +
            '<div class="vanilla-toast-title">' + title + '</div>' +
            '<div class="vanilla-toast-message">' + message + '</div></div>');
        toast.fade = function (type, ms, onEnd) {
            var self = toast;
            var isIn = type === 'in', opacity = isIn ? 0 : 1, interval = 10, duration = ms, gap = interval / duration;
            if (isIn) {
                self.style.display = 'block';
                self.style.opacity = opacity;
            }
            function func() {
                opacity = isIn ? opacity + gap : opacity - gap;
                self.style.opacity = opacity;
                if (opacity <= 0)
                    self.style.display = 'none';
                if (opacity <= 0 || opacity >= 1) {
                    window.clearInterval(fading);
                    if (onEnd != null)
                        onEnd();
                }
            }
            var fading = window.setInterval(func, interval);
        };
        toast.fadeIn = function (ms, onEnd) {
            toast.fade("in", ms, onEnd);
        };
        toast.fadeOut = function (ms, onEnd) {
            toast.fade("out", ms, onEnd);
        };
        return toast;
    };
    VanillaToast.prototype.addToast = function (toast, position, duration) {
        if (duration === void 0) { duration = 0; }
        var self = this;
        if (duration <= self.REMOVE_TIME_MIN_MS) {
            duration = self.REMOVE_TIME_MIN_MS;
        }
        var container = this.getContainer(position);
        container.appendChild(toast);
        var closeBtn = document.createElement("div");
        closeBtn.className = "vanilla-toast-icon-close";
        toast.appendChild(closeBtn);
        closeBtn.addEventListener("pointerdown", function () {
            self.removeToast(toast);
        });
        setTimeout(function () {
            self.removeToast(toast);
        }, duration);
        toast.fadeIn(VanillaToast.FADE_MS);
        return toast;
    };
    VanillaToast.prototype.getContainer = function (position) {
        if (position == ToastPosition.TOP_LEFT && !this.containerTopLeft) {
            this.containerTopLeft = this.createContainer(position);
        }
        else if (position == ToastPosition.TOP_RIGHT && !this.containerTopRight) {
            this.containerTopRight = this.createContainer(position);
        }
        else if (position == ToastPosition.BOTTOM_LEFT && !this.containerBottomLeft) {
            this.containerBottomLeft = this.createContainer(position);
        }
        else if (position == ToastPosition.BOTTOM_RIGHT && !this.containerBottomRight) {
            this.containerBottomRight = this.createContainer(position);
        }
        if (position == ToastPosition.TOP_LEFT) {
            return this.containerTopLeft;
        }
        else if (position == ToastPosition.TOP_RIGHT) {
            return this.containerTopRight;
        }
        else if (position == ToastPosition.BOTTOM_LEFT) {
            return this.containerBottomLeft;
        }
        else if (position == ToastPosition.BOTTOM_RIGHT) {
            return this.containerBottomRight;
        }
        return this.containerBottomLeft;
    };
    VanillaToast.prototype.createContainer = function (position) {
        var container = document.createElement("div");
        container.className = "vanilla-toast-container-" + position;
        this.parent.appendChild(container);
        return container;
    };
    VanillaToast.prototype.useFixedParent = function () {
        var containers = document.getElementsByClassName("vanilla-toast-container-fixed");
        if (containers != null && containers.length > 0) {
            this.parent = containers[0];
            return;
        }
        var container = document.createElement("div");
        container.className = "vanilla-toast-container-fixed";
        document.body.appendChild(container);
        this.parent = container;
    };
    VanillaToast.prototype.removeToast = function (toast) {
        toast.fadeOut(VanillaToast.FADE_MS, function () {
            toast.remove();
        });
    };
    VanillaToast.FADE_MS = 400;
    return VanillaToast;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvVmFuaWxsYVRvYXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUssU0FPSjtBQVBELFdBQUssU0FBUztJQUNaLGdDQUFtQixDQUFBO0lBQ25CLDBCQUFhLENBQUE7SUFDYixnQ0FBbUIsQ0FBQTtJQUNuQiw0QkFBZSxDQUFBO0lBQ2YsNEJBQWUsQ0FBQTtJQUNmLDhCQUFpQixDQUFBO0FBQ25CLENBQUMsRUFQSSxTQUFTLEtBQVQsU0FBUyxRQU9iO0FBRUQsSUFBSyxhQUtKO0FBTEQsV0FBSyxhQUFhO0lBQ2hCLHdDQUF1QixDQUFBO0lBQ3ZCLHNDQUFxQixDQUFBO0lBQ3JCLDhDQUE2QixDQUFBO0lBQzdCLDRDQUEyQixDQUFBO0FBQzdCLENBQUMsRUFMSSxhQUFhLEtBQWIsYUFBYSxRQUtqQjtBQUVEO0lBWUUsc0JBQVksTUFBVztRQVRmLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLHVCQUFrQixHQUFHLEdBQUcsQ0FBQztRQVMvQixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksSUFBSTtZQUNoQixNQUFNLElBQUksTUFBTTtZQUNoQixNQUFNLElBQUksUUFBUTtZQUNsQixNQUFNLElBQUksUUFBUSxDQUFDLElBQUk7WUFDdkIsTUFBTSxJQUFJLE1BQ1osQ0FBQyxDQUFDLENBQUM7WUFDRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDeEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDdkIsQ0FBQztJQUNILENBQUM7SUFFTSxrQ0FBVyxHQUFsQixVQUFtQixLQUFhLEVBQUUsT0FBZSxFQUFFLFFBQW1ELEVBQUUsUUFBOEI7UUFBbkYseUJBQUEsRUFBQSxXQUEwQixhQUFhLENBQUMsV0FBVztRQUFFLHlCQUFBLEVBQUEsV0FBVyxJQUFJLENBQUMsY0FBYztRQUNwSSxJQUFJLElBQUksR0FBZ0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVB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LEVBQUU7WUFDaEMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2pCLENBQUMsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQXpNYyxvQkFBTyxHQUFHLEdBQUcsQ0FBQztJQTBNL0IsbUJBQUM7Q0E1TUQsQUE0TUMsSUFBQSIsImZpbGUiOiJzY3JpcHRzL1ZhbmlsbGFUb2FzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImVudW0gVG9hc3RUeXBlIHtcbiAgU1VDQ0VTUyA9IFwic3VjY2Vzc1wiLFxuICBJTkZPID0gXCJpbmZvXCIsXG4gIFdBUk5JTkcgPSBcIndhcm5pbmdcIixcbiAgRVJST1IgPSBcImVycm9yXCIsXG4gIFBMQUlOID0gXCJwbGFpblwiLFxuICBDVVNUT00gPSBcImN1c3RvbVwiXG59XG5cbmVudW0gVG9hc3RQb3NpdGlvbiB7XG4gIFRPUF9SSUdIVCA9IFwidG9wLXJpZ2h0XCIsXG4gIFRPUF9MRUZUID0gXCJ0b3AtbGVmdFwiLFxuICBCT1RUT01fUklHSFQgPSBcImJvdHRvbS1yaWdodFwiLFxuICBCT1RUT01fTEVGVCA9IFwiYm90dG9tLWxlZnRcIlxufVxuXG5jbGFzcyBWYW5pbGxhVG9hc3Qge1xuXG4gIHByaXZhdGUgc3RhdGljIEZBREVfTVMgPSA0MDA7XG4gIHByaXZhdGUgUkVNT1ZFX1RJTUVfTVMgPSAzMDAwO1xuICBwcml2YXRlIFJFTU9WRV9USU1FX01JTl9NUyA9IDMwMDtcblxuICBwcml2YXRlIHBhcmVudDogYW55O1xuICBwcml2YXRlIGNvbnRhaW5lclRvcExlZnQ6IGFueTtcbiAgcHJpdmF0ZSBjb250YWluZXJUb3BSaWdodDogYW55O1xuICBwcml2YXRlIGNvbnRhaW5lckJvdHRvbUxlZnQ6IGFueTtcbiAgcHJpdmF0ZSBjb250YWluZXJCb3R0b21SaWdodDogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogYW55KSB7XG4gICAgaWYgKHBhcmVudCA9PSBudWxsIHx8XG4gICAgICBwYXJlbnQgPT0gXCJib2R5XCIgfHxcbiAgICAgIHBhcmVudCA9PSBcIndpbmRvd1wiIHx8XG4gICAgICBwYXJlbnQgPT0gZG9jdW1lbnQuYm9keSB8fFxuICAgICAgcGFyZW50ID09IHdpbmRvd1xuICAgICkge1xuICAgICAgdGhpcy51c2VGaXhlZFBhcmVudCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2hvd1N1Y2Nlc3ModGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQsIGR1cmF0aW9uID0gdGhpcy5SRU1PVkVfVElNRV9NUyk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGV4dDogSFRNTEVsZW1lbnQgPSB0aGlzLmdldEN1c3RvbVRvYXN0KHRpdGxlLCBtZXNzYWdlLCBUb2FzdFR5cGUuU1VDQ0VTUyk7XG4gICAgbGV0IHRvYXN0OiBIVE1MRWxlbWVudCA9IHRoaXMuYWRkVG9hc3QodGV4dCwgcG9zaXRpb24sIGR1cmF0aW9uKTtcbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwdWJsaWMgc2hvd0luZm8odGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQsIGR1cmF0aW9uID0gdGhpcy5SRU1PVkVfVElNRV9NUyk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGV4dDogSFRNTEVsZW1lbnQgPSB0aGlzLmdldEN1c3RvbVRvYXN0KHRpdGxlLCBtZXNzYWdlLCBUb2FzdFR5cGUuSU5GTyk7XG4gICAgbGV0IHRvYXN0OiBIVE1MRWxlbWVudCA9IHRoaXMuYWRkVG9hc3QodGV4dCwgcG9zaXRpb24sIGR1cmF0aW9uKTtcbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwdWJsaWMgc2hvd1dhcm5pbmcodGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQsIGR1cmF0aW9uID0gdGhpcy5SRU1PVkVfVElNRV9NUyk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGV4dDogSFRNTEVsZW1lbnQgPSB0aGlzLmdldEN1c3RvbVRvYXN0KHRpdGxlLCBtZXNzYWdlLCBUb2FzdFR5cGUuV0FSTklORyk7XG4gICAgbGV0IHRvYXN0OiBIVE1MRWxlbWVudCA9IHRoaXMuYWRkVG9hc3QodGV4dCwgcG9zaXRpb24sIGR1cmF0aW9uKTtcbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwdWJsaWMgc2hvd0Vycm9yKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgcG9zaXRpb246IFRvYXN0UG9zaXRpb24gPSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZULCBkdXJhdGlvbiA9IHRoaXMuUkVNT1ZFX1RJTUVfTVMpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRleHQ6IEhUTUxFbGVtZW50ID0gdGhpcy5nZXRDdXN0b21Ub2FzdCh0aXRsZSwgbWVzc2FnZSwgVG9hc3RUeXBlLkVSUk9SKTtcbiAgICBsZXQgdG9hc3Q6IEhUTUxFbGVtZW50ID0gdGhpcy5hZGRUb2FzdCh0ZXh0LCBwb3NpdGlvbiwgZHVyYXRpb24pO1xuICAgIHJldHVybiB0b2FzdDtcbiAgfVxuXG4gIHB1YmxpYyBzaG93UGxhaW4odGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBwb3NpdGlvbjogVG9hc3RQb3NpdGlvbiA9IFRvYXN0UG9zaXRpb24uQk9UVE9NX0xFRlQsIGR1cmF0aW9uID0gdGhpcy5SRU1PVkVfVElNRV9NUyk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGV4dDogSFRNTEVsZW1lbnQgPSB0aGlzLmdldEN1c3RvbVRvYXN0KHRpdGxlLCBtZXNzYWdlLCBUb2FzdFR5cGUuUExBSU4pO1xuICAgIGxldCB0b2FzdDogSFRNTEVsZW1lbnQgPSB0aGlzLmFkZFRvYXN0KHRleHQsIHBvc2l0aW9uLCBkdXJhdGlvbik7XG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHVibGljIHNob3dDdXN0b20odGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBpY29uVXJsOiBzdHJpbmcsIHBvc2l0aW9uOiBUb2FzdFBvc2l0aW9uID0gVG9hc3RQb3NpdGlvbi5CT1RUT01fTEVGVCwgZHVyYXRpb24gPSB0aGlzLlJFTU9WRV9USU1FX01TKTogSFRNTEVsZW1lbnQge1xuICAgIGxldCB0ZXh0OiBIVE1MRWxlbWVudCA9IHRoaXMuZ2V0Q3VzdG9tVG9hc3QodGl0bGUsIG1lc3NhZ2UsIFRvYXN0VHlwZS5DVVNUT00sIGljb25VcmwpO1xuICAgIGxldCB0b2FzdDogSFRNTEVsZW1lbnQgPSB0aGlzLmFkZFRvYXN0KHRleHQsIHBvc2l0aW9uLCBkdXJhdGlvbik7XG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDdXN0b21Ub2FzdCh0aXRsZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIHR5cGU6IFRvYXN0VHlwZSwgaWNvblVybD86IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcblxuICAgIGlmICghdGl0bGUpIHRpdGxlID0gXCIgXCI7XG4gICAgaWYgKCFtZXNzYWdlKSBtZXNzYWdlID0gXCIgXCI7XG5cbiAgICBsZXQgaWNvbiA9ICc8ZGl2IGNsYXNzPVwidmFuaWxsYS10b2FzdC1pY29uXCI+PC9kaXY+JztcbiAgICBpZiAodHlwZSA9PSBUb2FzdFR5cGUuQ1VTVE9NKSB7XG4gICAgICBpY29uID0gJzxkaXYgY2xhc3M9XCJ2YW5pbGxhLXRvYXN0LWljb25cIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnICsgaWNvblVybCArICcpO1wiPjwvZGl2Pic7XG4gICAgfVxuXG4gICAgbGV0IHRvYXN0OiBhbnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRvYXN0LmNsYXNzTmFtZSA9IFwidmFuaWxsYS10b2FzdCB2YW5pbGxhLXRvYXN0LVwiICsgdHlwZTtcbiAgICB0b2FzdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdG9hc3QuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJiZWdpblwiLFxuICAgICAgaWNvbiArXG4gICAgICAnPGRpdiBjbGFzcz1cInZhbmlsbGEtdG9hc3QtdGV4dFwiPicgK1xuICAgICAgJzxkaXYgY2xhc3M9XCJ2YW5pbGxhLXRvYXN0LXRpdGxlXCI+JyArIHRpdGxlICsgJzwvZGl2PicgK1xuICAgICAgJzxkaXYgY2xhc3M9XCJ2YW5pbGxhLXRvYXN0LW1lc3NhZ2VcIj4nICsgbWVzc2FnZSArICc8L2Rpdj48L2Rpdj4nXG4gICAgKTtcblxuICAgIHRvYXN0LmZhZGUgPSAodHlwZTogc3RyaW5nLCBtczogbnVtYmVyLCBvbkVuZD86ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIGxldCBzZWxmOiBhbnkgPSB0b2FzdDtcblxuICAgICAgbGV0IGlzSW4gPSB0eXBlID09PSAnaW4nLFxuICAgICAgICBvcGFjaXR5ID0gaXNJbiA/IDAgOiAxLFxuICAgICAgICBpbnRlcnZhbCA9IDEwLFxuICAgICAgICBkdXJhdGlvbiA9IG1zLFxuICAgICAgICBnYXAgPSBpbnRlcnZhbCAvIGR1cmF0aW9uO1xuXG4gICAgICBpZiAoaXNJbikge1xuICAgICAgICBzZWxmLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICBzZWxmLnN0eWxlLm9wYWNpdHkgPSBvcGFjaXR5O1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBmdW5jKCkge1xuICAgICAgICBvcGFjaXR5ID0gaXNJbiA/IG9wYWNpdHkgKyBnYXAgOiBvcGFjaXR5IC0gZ2FwO1xuICAgICAgICBzZWxmLnN0eWxlLm9wYWNpdHkgPSBvcGFjaXR5O1xuXG4gICAgICAgIGlmIChvcGFjaXR5IDw9IDApIHNlbGYuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgICAgICBpZiAob3BhY2l0eSA8PSAwIHx8IG9wYWNpdHkgPj0gMSkge1xuICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGZhZGluZyk7XG4gICAgICAgICAgaWYgKG9uRW5kICE9IG51bGwpIG9uRW5kKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IGZhZGluZyA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jLCBpbnRlcnZhbCk7XG4gICAgfTtcblxuICAgIHRvYXN0LmZhZGVJbiA9IChtczogbnVtYmVyLCBvbkVuZD86ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIHRvYXN0LmZhZGUoXCJpblwiLCBtcywgb25FbmQpO1xuICAgIH07XG5cbiAgICB0b2FzdC5mYWRlT3V0ID0gKG1zOiBudW1iZXIsIG9uRW5kPzogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgdG9hc3QuZmFkZShcIm91dFwiLCBtcywgb25FbmQpO1xuICAgIH07XG5cbiAgICByZXR1cm4gdG9hc3Q7XG4gIH1cblxuICBwcml2YXRlIGFkZFRvYXN0KHRvYXN0OiBhbnksIHBvc2l0aW9uOiBUb2FzdFBvc2l0aW9uLCBkdXJhdGlvbjogbnVtYmVyID0gMCk6IEhUTUxFbGVtZW50IHtcblxuICAgIGxldCBzZWxmID0gdGhpcztcblxuICAgIGlmIChkdXJhdGlvbiA8PSBzZWxmLlJFTU9WRV9USU1FX01JTl9NUykge1xuICAgICAgZHVyYXRpb24gPSBzZWxmLlJFTU9WRV9USU1FX01JTl9NUztcbiAgICB9XG5cbiAgICBsZXQgY29udGFpbmVyOiBhbnkgPSB0aGlzLmdldENvbnRhaW5lcihwb3NpdGlvbik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRvYXN0KTtcblxuICAgIC8vIEFkZCBjbG9zZSBidXR0b25cbiAgICBsZXQgY2xvc2VCdG46IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjbG9zZUJ0bi5jbGFzc05hbWUgPSBcInZhbmlsbGEtdG9hc3QtaWNvbi1jbG9zZVwiO1xuICAgIHRvYXN0LmFwcGVuZENoaWxkKGNsb3NlQnRuKTtcblxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyZG93blwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZWxmLnJlbW92ZVRvYXN0KHRvYXN0KTtcbiAgICB9KTtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5yZW1vdmVUb2FzdCh0b2FzdClcbiAgICB9LCBkdXJhdGlvbik7XG5cbiAgICB0b2FzdC5mYWRlSW4oVmFuaWxsYVRvYXN0LkZBREVfTVMpO1xuXG4gICAgcmV0dXJuIHRvYXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb250YWluZXIocG9zaXRpb246IFRvYXN0UG9zaXRpb24pOiBhbnkge1xuXG4gICAgaWYgKHBvc2l0aW9uID09IFRvYXN0UG9zaXRpb24uVE9QX0xFRlQgJiYgIXRoaXMuY29udGFpbmVyVG9wTGVmdCkge1xuICAgICAgdGhpcy5jb250YWluZXJUb3BMZWZ0ID0gdGhpcy5jcmVhdGVDb250YWluZXIocG9zaXRpb24pO1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5UT1BfUklHSFQgJiYgIXRoaXMuY29udGFpbmVyVG9wUmlnaHQpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyVG9wUmlnaHQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lcihwb3NpdGlvbik7XG4gICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PSBUb2FzdFBvc2l0aW9uLkJPVFRPTV9MRUZUICYmICF0aGlzLmNvbnRhaW5lckJvdHRvbUxlZnQpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyQm90dG9tTGVmdCA9IHRoaXMuY3JlYXRlQ29udGFpbmVyKHBvc2l0aW9uKTtcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09IFRvYXN0UG9zaXRpb24uQk9UVE9NX1JJR0hUICYmICF0aGlzLmNvbnRhaW5lckJvdHRvbVJpZ2h0KSB7XG4gICAgICB0aGlzLmNvbnRhaW5lckJvdHRvbVJpZ2h0ID0gdGhpcy5jcmVhdGVDb250YWluZXIocG9zaXRpb24pO1xuICAgIH1cblxuICAgIGlmIChwb3NpdGlvbiA9PSBUb2FzdFBvc2l0aW9uLlRPUF9MRUZUKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb250YWluZXJUb3BMZWZ0O1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5UT1BfUklHSFQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lclRvcFJpZ2h0O1xuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gVG9hc3RQb3NpdGlvbi5CT1RUT01fTEVGVCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyQm90dG9tTGVmdDtcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09IFRvYXN0UG9zaXRpb24uQk9UVE9NX1JJR0hUKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb250YWluZXJCb3R0b21SaWdodDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jb250YWluZXJCb3R0b21MZWZ0O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDb250YWluZXIocG9zaXRpb246IFRvYXN0UG9zaXRpb24pOiBhbnkge1xuICAgIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSBcInZhbmlsbGEtdG9hc3QtY29udGFpbmVyLVwiICsgcG9zaXRpb247XG4gICAgdGhpcy5wYXJlbnQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSB1c2VGaXhlZFBhcmVudCgpIHtcblxuICAgIC8vIFRyeSB0byBmaW5kIGFscmVhZHkgZXhpc3RpbmcgY29udGFpbmVyXG4gICAgbGV0IGNvbnRhaW5lcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwidmFuaWxsYS10b2FzdC1jb250YWluZXItZml4ZWRcIik7XG4gICAgaWYgKGNvbnRhaW5lcnMgIT0gbnVsbCAmJiBjb250YWluZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMucGFyZW50ID0gY29udGFpbmVyc1swXTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJ2YW5pbGxhLXRvYXN0LWNvbnRhaW5lci1maXhlZFwiO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgIHRoaXMucGFyZW50ID0gY29udGFpbmVyO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVUb2FzdCh0b2FzdDogYW55KSB7XG5cbiAgICB0b2FzdC5mYWRlT3V0KFZhbmlsbGFUb2FzdC5GQURFX01TLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRvYXN0LnJlbW92ZSgpO1xuICAgICAgfVxuICAgICk7XG4gIH1cbn1cbiJdfQ==
